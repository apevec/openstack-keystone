From 426549934e323a9bc435b9ec58163e88f5e74a32 Mon Sep 17 00:00:00 2001
From: Sam Morrison <sorrison@gmail.com>
Date: Mon, 7 May 2012 09:09:57 +1000
Subject: [PATCH] Corrects url conversion in export_legacy_catalog

Fixes bug 994936

Change-Id: Ia63fdae7d0bcd7f8b0b587da588404765e22fb8f
---
 AUTHORS                       |    1 +
 keystone/common/sql/legacy.py |    2 +-
 tests/test_import_legacy.py   |    2 +-
 3 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/AUTHORS b/AUTHORS
index b8d2014..a33f07e 100644
--- a/AUTHORS
+++ b/AUTHORS
@@ -86,6 +86,7 @@ Russell Bryant <rbryant@redhat.com>
 saikrishna1511@gmail.com <psaikrishna@ubudesk1004.(none)>
 Sai Krishna <saikrishna1511@gmail.com>
 Salvatore Orlando <salvatore.orlando@eu.citrix.com>
+Sam Morrison <sorrison@gmail.com>
 Sandy Walsh <sandy@sandywalsh.com>
 Shevek <shevek@nebula.com>
 sirish bitra <sirish.bitra@gmail.com>
diff --git a/keystone/common/sql/legacy.py b/keystone/common/sql/legacy.py
index ca19ccb..55e27b3 100644
--- a/keystone/common/sql/legacy.py
+++ b/keystone/common/sql/legacy.py
@@ -77,7 +77,7 @@ class LegacyMigration(object):
                  'region': row['region']}
 
             for x in ['internal_url', 'public_url', 'admin_url', 'enabled']:
-                d['key'] = x.replace('_u', 'U')
+                d['key'] = x.replace('_url', 'URL')
                 d['value'] = _translate_replacements(row[x])
                 o.append(template % d)
 
diff --git a/tests/test_import_legacy.py b/tests/test_import_legacy.py
index aa3c517..6ae829c 100644
--- a/tests/test_import_legacy.py
+++ b/tests/test_import_legacy.py
@@ -108,4 +108,4 @@ class ImportLegacy(test.TestCase):
         catalog = catalog_templated.parse_templates(catalog_lines)
         self.assert_('RegionOne' in catalog)
         self.assert_('compute' in catalog['RegionOne'])
-        self.assert_('adminUrl' in catalog['RegionOne']['compute'])
+        self.assert_('adminURL' in catalog['RegionOne']['compute'])
